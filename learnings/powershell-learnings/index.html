<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Comprehensive automation framework for Unity development with Claude AI integration"><meta name=author content="Unity Claude Automation Team"><link href=https://github.com/Unity-Claude-Automation/learnings/powershell-learnings/ rel=canonical><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.17"><title>Powershell learnings - Unity-Claude-Automation</title><link rel=stylesheet href=../../assets/stylesheets/main.7e37652d.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/_mkdocstrings.css><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#powershell-specific-learnings class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=Unity-Claude-Automation class="md-header__button md-logo" aria-label=Unity-Claude-Automation data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18.41 4 16 6.41v.18L18.41 9H22v2h-4.41L16 9.41V12h-1a2 2 0 0 1-2-2V7.5H9.86c-.09.37-.24.72-.44 1.05L15.18 19H20a2 2 0 0 1 2 2v1H2v-1a2 2 0 0 1 2-2h6.61l-4.69-8.5a4.006 4.006 0 0 1-3.81-3A4 4 0 0 1 5 2.63c2.13-.55 4.31.73 4.86 2.87H13V3a2 2 0 0 1 2-2h1v2.59L17.59 2H22v2zM6 4.5a2 2 0 0 0-2 2 2 2 0 0 0 2 2 2 2 0 0 0 2-2 2 2 0 0 0-2-2"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Unity-Claude-Automation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Powershell learnings </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/Unity-Claude-Automation title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> Unity-Claude-Automation </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../getting-started/installation/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../user-guide/overview/ class=md-tabs__link> User Guide </a> </li> <li class=md-tabs__item> <a href=../../modules/overview/ class=md-tabs__link> Modules </a> </li> <li class=md-tabs__item> <a href=../../api/powershell/core/ class=md-tabs__link> API Reference </a> </li> <li class=md-tabs__item> <a href=../../advanced/multi-agent/ class=md-tabs__link> Advanced Topics </a> </li> <li class=md-tabs__item> <a href=../../development/contributing/ class=md-tabs__link> Development </a> </li> <li class=md-tabs__item> <a href=../../resources/learnings/ class=md-tabs__link> Resources </a> </li> <li class=md-tabs__item> <a href=../../about/license/ class=md-tabs__link> About </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=Unity-Claude-Automation class="md-nav__button md-logo" aria-label=Unity-Claude-Automation data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18.41 4 16 6.41v.18L18.41 9H22v2h-4.41L16 9.41V12h-1a2 2 0 0 1-2-2V7.5H9.86c-.09.37-.24.72-.44 1.05L15.18 19H20a2 2 0 0 1 2 2v1H2v-1a2 2 0 0 1 2-2h6.61l-4.69-8.5a4.006 4.006 0 0 1-3.81-3A4 4 0 0 1 5 2.63c2.13-.55 4.31.73 4.86 2.87H13V3a2 2 0 0 1 2-2h1v2.59L17.59 2H22v2zM6 4.5a2 2 0 0 0-2 2 2 2 0 0 0 2 2 2 2 0 0 0 2-2 2 2 0 0 0-2-2"/></svg> </a> Unity-Claude-Automation </label> <div class=md-nav__source> <a href=https://github.com/Unity-Claude-Automation title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> Unity-Claude-Automation </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../getting-started/installation/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../user-guide/overview/ class=md-nav__link> <span class=md-ellipsis> User Guide </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../modules/overview/ class=md-nav__link> <span class=md-ellipsis> Modules </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../api/powershell/core/ class=md-nav__link> <span class=md-ellipsis> API Reference </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../advanced/multi-agent/ class=md-nav__link> <span class=md-ellipsis> Advanced Topics </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../development/contributing/ class=md-nav__link> <span class=md-ellipsis> Development </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../resources/learnings/ class=md-nav__link> <span class=md-ellipsis> Resources </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../about/license/ class=md-nav__link> <span class=md-ellipsis> About </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/Unity-Claude-Automation/edit/main/docs/learnings/powershell-learnings.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg> </a> <a href=https://github.com/Unity-Claude-Automation/raw/main/docs/learnings/powershell-learnings.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg> </a> <h1>Powershell learnings</h1> <h2 id=powershell-specific-learnings>PowerShell Specific Learnings<a class=headerlink href=#powershell-specific-learnings title="Permanent link">&para;</a></h2> <p><em>Critical PowerShell knowledge, syntax issues, compatibility fixes, and best practices</em></p> <h3 id=character-encoding-and-unicode-issues>Character Encoding and Unicode Issues<a class=headerlink href=#character-encoding-and-unicode-issues title="Permanent link">&para;</a></h3> <h4 id=learning-234-unicode-characters-cause-powershell-parser-errors-2025-12-28>Learning #234: Unicode Characters Cause PowerShell Parser Errors (2025-12-28)<a class=headerlink href=#learning-234-unicode-characters-cause-powershell-parser-errors-2025-12-28 title="Permanent link">&para;</a></h4> <p><strong>Context</strong>: Test-CLIOrchestrator-Serialization.ps1 execution failure <strong>Issue</strong>: Non-ASCII Unicode characters (✓, ✗) in PowerShell scripts cause parser errors <strong>Critical Discovery</strong>: Unicode characters can trigger misleading "string terminator" errors <strong>Evidence</strong>: "The string is missing the terminator" error at line with Unicode character <strong>Root Cause</strong>: PowerShell parser has issues with certain Unicode characters in string literals <strong>Resolution</strong>: Replace all Unicode characters with ASCII equivalents <strong>Implementation</strong>: - Replace ✓ with [PASS] or similar ASCII indicator - Replace ✗ with [FAIL] or similar ASCII indicator<br> - Replace any other Unicode symbols with ASCII alternatives <strong>Critical Pattern</strong>: Always use ASCII-only characters in PowerShell scripts <strong>Best Practices</strong>: 1. Follow directive #15: "USE ASCII CHARACTERS ONLY" 2. Use bracketed text indicators like [PASS], [FAIL], [INFO] instead of symbols 3. Avoid emoji and special Unicode characters in all scripts 4. Test scripts for Unicode characters before deployment 5. Configure editors to show non-ASCII characters <strong>Technical Details</strong>: - PowerShell misinterprets Unicode as string termination issues - Error messages are misleading - reports missing quotes when issue is Unicode - Cascading errors occur (missing braces) due to initial parse failure - Issue occurs in both PowerShell 5.1 and PowerShell 7</p> <h3 id=object-serialization-and-string-interpolation>Object Serialization and String Interpolation<a class=headerlink href=#object-serialization-and-string-interpolation title="Permanent link">&para;</a></h3> <h4 id=learning-233-powershell-object-to-string-interpolation-corruption-2025-12-28>Learning #233: PowerShell Object-to-String Interpolation Corruption (2025-12-28)<a class=headerlink href=#learning-233-powershell-object-to-string-interpolation-corruption-2025-12-28 title="Permanent link">&para;</a></h4> <p><strong>Context</strong>: CLIOrchestrator prompt submission to Claude Code CLI <strong>Issue</strong>: Complex objects (hashtables/PSObjects) embedded in strings show as @{key=System.Object[]} instead of actual values <strong>Critical Discovery</strong>: Direct string interpolation "<span class=arithmatex>\(variable" calls ToString() which returns type info for complex objects **Evidence**: Prompt showing "@{week_1_priorities=System.Object[]}" instead of file path **Root Cause**: PowerShell default ToString() on hashtables returns type representation not content **Resolution**: Implement proper serialization helper function before string interpolation **Implementation**: <div class="language-powershell highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c># Helper function to properly serialize objects</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=k>function</span> <span class=nb>Convert-ToSerializedString</span> <span class=p>{</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>    <span class=k>param</span><span class=p>(</span><span class=nv>$InputObject</span><span class=p>)</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>    <span class=k>if</span> <span class=p>(</span><span class=nv>$InputObject</span> <span class=o>-is</span> <span class=no>[string]</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=nv>$InputObject</span> <span class=p>}</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>    <span class=k>if</span> <span class=p>(</span><span class=nv>$InputObject</span> <span class=o>-is</span> <span class=no>[hashtable]</span> <span class=o>-or</span> <span class=nv>$InputObject</span> <span class=o>-is</span> <span class=no>[PSCustomObject]</span><span class=p>)</span> <span class=p>{</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>        <span class=c># Extract file path properties</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>        <span class=nv>$pathProps</span> <span class=p>=</span> <span class=p>@(</span><span class=s1>&#39;Path&#39;</span><span class=p>,</span><span class=s1>&#39;FilePath&#39;</span><span class=p>,</span><span class=s1>&#39;FullName&#39;</span><span class=p>,</span><span class=s1>&#39;ImplementationPlan&#39;</span><span class=p>)</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>        <span class=k>foreach</span> <span class=p>(</span><span class=nv>$prop</span> <span class=k>in</span> <span class=nv>$pathProps</span><span class=p>)</span> <span class=p>{</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>            <span class=k>if</span> <span class=p>(</span><span class=nv>$InputObject</span><span class=p>.</span><span class=nv>$prop</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=nv>$InputObject</span><span class=p>.</span><span class=nv>$prop</span><span class=p>.</span><span class=n>ToString</span><span class=p>()</span> <span class=p>}</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>        <span class=p>}</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>        <span class=c># Fallback to JSON</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>        <span class=k>return</span> <span class=nv>$InputObject</span> <span class=p>|</span> <span class=nb>ConvertTo-Json</span> <span class=n>-Depth</span> <span class=n>5</span> <span class=n>-Compress</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>    <span class=p>}</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>    <span class=k>return</span> <span class=nv>$InputObject</span><span class=p>.</span><span class=n>ToString</span><span class=p>()</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=p>}</span>
</span></code></pre></div> **Critical Patterns**: - Always check object type before string interpolation - Use subexpression operator <span class=arithmatex>\(() for property access: "\)</span>(\)</span>hash.Property)" - Implement serialization helper for complex prompt building - Extract relevant string properties from objects <strong>Best Practices</strong>: 1. Never directly embed complex objects in strings with "$object" 2. Always serialize objects to meaningful strings first 3. Use -is operator for type checking: <code>$var -is [hashtable]</code> 4. ConvertTo-Json with -Depth parameter for nested objects 5. Test serialization with various object types <strong>Technical Details</strong>: - Default ConvertTo-Json depth of 2 causes nested "System.Object[]" - GetEnumerator() method for iterating hashtable key-value pairs - Select-Object -ExpandProperty extracts string values from PSObjects - .Values property returns hashtable values without @{} notation</p> <h3 id=count-property-and-collection-safety>Count Property and Collection Safety<a class=headerlink href=#count-property-and-collection-safety title="Permanent link">&para;</a></h3> <h4 id=learning-226-comprehensive-count-property-safety-final-resolution-2025-08-24>Learning #226: Comprehensive Count Property Safety - Final Resolution (2025-08-24)<a class=headerlink href=#learning-226-comprehensive-count-property-safety-final-resolution-2025-08-24 title="Permanent link">&para;</a></h4> <p><strong>Context</strong>: Phase 6 CPG Module Testing - Final resolution of persistent Test-CodeRedundancy op_Subtraction error <strong>Issue</strong>: Direct .Count property usage in arithmetic and comparison operations causing array-type errors <strong>Critical Discovery</strong>: Line 520 arithmetic operation <code>Count = $similarBlocks.Count + 1</code> was the primary culprit <strong>Evidence</strong>: Persistent op_Subtraction error despite multiple previous fixes - required comprehensive audit of all .Count usage <strong>Research Insight</strong>: "op_Subtraction" error messages are misleading and can occur with addition operations when Count returns array instead of scalar <strong>Complete Resolution</strong>: Applied Measure-Object pattern to ALL remaining .Count operations in Test-CodeRedundancy function <strong>Locations Fixed</strong>: 1. <strong>Line 520</strong>: <code>Count = ($similarBlocks | Measure-Object).Count + 1</code> - Critical arithmetic fix 2. <strong>Line 511</strong>: <code>if (($similarBlocks | Measure-Object).Count -gt 0)</code> - Comparison safety 3. <strong>Lines 483-484</strong>: Created <code>$totalBlocks</code> variable for loop conditions 4. <strong>Line 491</strong>: Used <code>$totalBlocks</code> in inner loop condition 5. <strong>Line 477</strong>: Write-Verbose statement with Measure-Object pattern 6. <strong>Line 535</strong>: Hashtable count using <code>($processed.Keys | Measure-Object).Count</code> <strong>Technical Understanding</strong>: - PowerShell PSv3+ accessing property on collection returns array of property values - Arrays don't support arithmetic operators (+-<em>/), causing op_Subtraction errors - Error message mentions "subtraction" even for addition operations due to operator implementation - Hashtables require .Keys collection for reliable counting in arithmetic contexts **Final Pattern*</em>: Always use <code>($collection | Measure-Object).Count</code> for ANY Count property used in arithmetic, comparisons, or string interpolation <strong>Success Criteria</strong>: 8/8 tests passing (100%) with no CLR crashes or array operation errors</p> <h4 id=learning-225-powershell-count-property-arithmetic-safety-2025-08-24>Learning #225: PowerShell Count Property Arithmetic Safety (2025-08-24)<a class=headerlink href=#learning-225-powershell-count-property-arithmetic-safety-2025-08-24 title="Permanent link">&para;</a></h4> <p><strong>Context</strong>: Phase 6 CPG Module Testing - Test-CodeRedundancy persistent op_Subtraction errors <strong>Issue</strong>: Count property from collections can return array instead of scalar in PowerShell 5.1 <strong>Discovery</strong>: Where-Object, Select-Object -Unique, and filtered collections' Count can behave as arrays <strong>Evidence</strong>: "Method invocation failed because [System.Object[]] does not contain a method named op_Subtraction" <strong>Resolution</strong>: Apply [int] cast to all Count properties used in arithmetic operations <strong>Critical Pattern</strong>: Use [int]@(collection).Count or [int]collection.Count for arithmetic safety <strong>Affected Operations</strong>: 1. Where-Object filtered collections: [int]@(<span class=arithmatex>\(collection | Where-Object {...}).Count 2. Select-Object -Unique: [int]@(\)</span>collection | Select-Object -Unique Property).Count<br> 3. Division operations: [int]<span class=arithmatex>\(numerator.Count / [int]\)</span>denominator.Count 4. Multiplication: <span class=arithmatex>\(value * [int]\)</span>collection.Count 5. Comparisons: if ([int]<span class=arithmatex>\(collection.Count -gt 0) **Best Practices**: - Always use [int] cast when Count will be used in arithmetic - Wrap filtered collections in @() before accessing Count - Alternative: Use (\)</span>collection | Measure-Object).Count for guaranteed scalar - Apply defensive coding: assume Count might return non-scalar <strong>Technical Details</strong>: - PowerShell 5.1 automatic type conversion can make single-item results non-arrays - Select-Object and Where-Object can return types that lack reliable Count property - Arithmetic operators (+-*/) require scalar operands, not arrays - Fixed 15 locations in ObsolescenceDetection module for complete resolution</p> <h3 id=type-system-and-enum-handling>Type System and Enum Handling<a class=headerlink href=#type-system-and-enum-handling title="Permanent link">&para;</a></h3> <h4 id=learning-224-powershell-enum-type-reference-consistency-2025-08-24>Learning #224: PowerShell Enum Type Reference Consistency (2025-08-24)<a class=headerlink href=#learning-224-powershell-enum-type-reference-consistency-2025-08-24 title="Permanent link">&para;</a></h4> <p><strong>Context</strong>: Phase 6 CPG Module Testing - Test-ObsolescenceDetection.ps1 failures <strong>Issue</strong>: Enum type references must match exact definition names - no partial resolution <strong>Discovery</strong>: ObsolescenceDetection module using [NodeType] when enum defined as CPGNodeType <strong>Evidence</strong>: "Unable to find type [NodeType]" errors in 6/8 tests (75% failure rate) <strong>Resolution</strong>: Updated all [NodeType] references to [CPGNodeType] throughout module <strong>Critical Insight</strong>: PowerShell 5.1 does not support partial type name resolution or automatic aliasing for enums <strong>Best Practices</strong>: 1. Always use fully qualified enum names matching exact definition 2. Verify enum naming consistency across all dependent modules 3. Load enum definitions before modules that reference them 4. Consider using type accelerators for complex scenarios but avoid for simple cases 5. Document enum names clearly in module manifests <strong>Technical Details</strong>: - Enums defined in Unity-Claude-CPG-Enums.ps1 as CPGNodeType - ObsolescenceDetection module expected NodeType (missing CPG prefix) - Affected functions: Find-UnreachableCode, Test-CodeRedundancy, Get-CodeComplexityMetrics, etc. - Fix: Simple find/replace of [NodeType] with [CPGNodeType]</p> <h3 id=powershell-51-compatibility-issues>PowerShell 5.1 Compatibility Issues<a class=headerlink href=#powershell-51-compatibility-issues title="Permanent link">&para;</a></h3> <h4 id=learning-170-powershell-51-concurrentqueue-instantiation-critical-issue-2025-08-20>Learning #170: PowerShell 5.1 ConcurrentQueue Instantiation Critical Issue (2025-08-20)<a class=headerlink href=#learning-170-powershell-51-concurrentqueue-instantiation-critical-issue-2025-08-20 title="Permanent link">&para;</a></h4> <p><strong>Context</strong>: Phase 3 Day 17 State Management Implementation <strong>Issue</strong>: Direct ConcurrentQueue instantiation fails in PowerShell 5.1 with AddType conflicts <strong>Evidence</strong>: "A type named 'ConcurrentQueue' already exists" error despite no previous declarations <strong>Root Cause</strong>: PowerShell 5.1's automatic type resolution conflicts with System.Collections.Concurrent namespace <strong>Resolution</strong>: Use full namespace qualification consistently <strong>Critical Pattern</strong>: <code>[System.Collections.Concurrent.ConcurrentQueue[psobject]]::new()</code> <strong>Best Practices</strong>: - Never use shortened type names for concurrent collections in PS 5.1 - Always fully qualify System.Collections.Concurrent types - Test instantiation patterns thoroughly in PS 5.1 environments - Consider wrapper classes for complex concurrent types</p> <h3 id=semantic-analysis-and-pattern-detection>Semantic Analysis and Pattern Detection<a class=headerlink href=#semantic-analysis-and-pattern-detection title="Permanent link">&para;</a></h3> <h4 id=learning-235-powershell-singleton-pattern-detection-specifics-2025-08-28>Learning #235: PowerShell Singleton Pattern Detection Specifics (2025-08-28)<a class=headerlink href=#learning-235-powershell-singleton-pattern-detection-specifics-2025-08-28 title="Permanent link">&para;</a></h4> <p><strong>Context</strong>: Week 2 Day 3 Semantic Analysis - Test-Week2Day3-SemanticAnalysis.ps1 singleton detection failure <strong>Issue</strong>: Traditional OOP singleton pattern detection fails with PowerShell class syntax <strong>Critical Discovery</strong>: PowerShell uses <code>hidden</code> keyword instead of <code>private</code> for constructor restriction <strong>Evidence</strong>: Test singleton class with <code>hidden</code> constructor not detected by pattern matching <strong>Root Cause</strong>: Pattern detection logic expected traditional <code>private</code> constructor syntax <strong>Resolution</strong>: Updated singleton detection to recognize PowerShell-specific patterns <strong>PowerShell Singleton Characteristics</strong>: - Uses <code>hidden</code> keyword for constructor restriction (not <code>private</code>) - Static property/field for instance storage: <code>hidden static [Class] $Instance</code> - Static access method: <code>static [Class] GetInstance()</code> - Lazy initialization with conditional instantiation in GetInstance() <strong>Pattern Detection Updates</strong>: 1. Check for <code>hidden</code> constructors instead of <code>private</code> 2. Accept non-public constructors as potential singleton indicators 3. Enhanced static property detection including AST field analysis 4. Regex-based static method name matching: <code>Get.*Instance|GetSingleton|Instance</code> 5. Bonus scoring for lazy initialization patterns (if statements in access methods) <strong>Best Practices</strong>: - PowerShell singleton detection requires language-specific criteria - Confidence scoring should account for PowerShell syntax differences - AST analysis must check both Properties and AST Members for static fields - Debug logging essential for pattern matching troubleshooting</p> <h4 id=learning-236-ast-method-interaction-analysis-for-cohesion-metrics-2025-08-28>Learning #236: AST Method Interaction Analysis for Cohesion Metrics (2025-08-28)<a class=headerlink href=#learning-236-ast-method-interaction-analysis-for-cohesion-metrics-2025-08-28 title="Permanent link">&para;</a></h4> <p><strong>Context</strong>: Week 2 Day 3 Semantic Analysis - CHM (Cohesion at Message Level) calculation failure <strong>Issue</strong>: Method interaction analysis not detecting internal class method calls correctly <strong>Critical Discovery</strong>: PowerShell AST requires specific filtering for "this" variable and member expressions <strong>Evidence</strong>: CHM calculation returning 0 internal calls despite test class having internal method calls <strong>Root Cause</strong>: InvokeMemberExpressionAst filtering too broad, not distinguishing internal vs external calls <strong>Resolution</strong>: Enhanced method call detection with proper "this" variable filtering <strong>Technical Implementation</strong>: 1. <strong>Explicit "this" calls</strong>: Filter by <code>VariableExpressionAst.VariablePath.UserPath -eq "this"</code> 2. <strong>Potential internal calls</strong>: Check InvokeMemberExpressionAst without "this" but matching class method names 3. <strong>Member vs Method distinction</strong>: Use StringConstantExpressionAst vs generic ToString() for method names 4. <strong>Class method verification</strong>: Cross-reference called method names with class method list <strong>AST Analysis Patterns</strong>: <div class="language-powershell highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c># Find explicit &#39;this&#39; method calls</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=nv>$memberCalls</span> <span class=p>=</span> <span class=nv>$method</span><span class=p>.</span><span class=n>Body</span><span class=p>.</span><span class=n>FindAll</span><span class=p>({</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>    <span class=k>param</span><span class=p>(</span><span class=nv>$node</span><span class=p>)</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>    <span class=nv>$node</span> <span class=o>-is</span> <span class=no>[InvokeMemberExpressionAst]</span> <span class=o>-and</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>    <span class=nv>$node</span><span class=p>.</span><span class=n>Expression</span> <span class=o>-is</span> <span class=no>[VariableExpressionAst]</span> <span class=o>-and</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>    <span class=nv>$node</span><span class=p>.</span><span class=n>Expression</span><span class=p>.</span><span class=n>VariablePath</span><span class=p>.</span><span class=n>UserPath</span> <span class=o>-eq</span> <span class=s2>&quot;this&quot;</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=p>},</span> <span class=nv>$true</span><span class=p>)</span>
</span></code></pre></div> <strong>Best Practices</strong>: - Always use proper VariableExpressionAst filtering for "this" detection - Distinguish between explicit and implicit internal method calls - Add comprehensive debug logging for interaction counting - Verify method names exist in current class before counting as internal</p> <h4 id=learning-237-powershell-class-backtick-escape-sequence-issues-2025-08-28>Learning #237: PowerShell Class Backtick Escape Sequence Issues (2025-08-28)<a class=headerlink href=#learning-237-powershell-class-backtick-escape-sequence-issues-2025-08-28 title="Permanent link">&para;</a></h4> <p><strong>Context</strong>: Week 2 Day 3 Semantic Analysis - Test file parse errors affecting pattern detection <strong>Issue</strong>: Backtick escape sequences in PowerShell class parameter definitions cause AST parsing errors <strong>Critical Discovery</strong>: Backticks before $ in class syntax are unnecessary and problematic <strong>Evidence</strong>: Parse errors in test files with <code>$variable</code> syntax in class definitions <strong>Root Cause</strong>: PowerShell class syntax doesn't require backtick escaping for $ in parameter definitions <strong>Resolution</strong>: Remove all backticks from PowerShell class syntax in test files <strong>Problematic Patterns</strong>: - <code>hidden static [Class]</code>$Instance<code>(should be:</code>hidden static [Class] <span class=arithmatex>\(Instance<code>) -</code>[void] Method([string] <code>$param)</code> (should be: <code>[void] Method([string] $param)</code>) - <code>return</code>\)</span>this.Property<code>(should be:</code>return $this.Property<code>) **Critical Understanding**: - PowerShell class syntax uses standard $ variable notation without backticks - Backticks in class definitions can cause "string terminator" and parsing errors - Apply Learning #234 (ASCII characters only) includes avoiding unnecessary backticks **Best Practices**: 1. Never use backticks before $ in PowerShell class parameter definitions 2. Use clean syntax:</code>[Type] $parameter<code>not</code>[Type] <code>$parameter</code> 3. Class property access: <code>$this.Property</code> not <code>$this.Property</code> 4. Test all class syntax with AST parsing before pattern analysis 5. Apply ASCII-only principle to all test code and class definitions</p> <h4 id=learning-238-powershell-51-utf-8-bom-issues-in-ast-parsing-2025-08-28>Learning #238: PowerShell 5.1 UTF-8 BOM Issues in AST Parsing (2025-08-28)<a class=headerlink href=#learning-238-powershell-51-utf-8-bom-issues-in-ast-parsing-2025-08-28 title="Permanent link">&para;</a></h4> <p><strong>Context</strong>: Week 2 Day 3 Semantic Analysis - Test regression from 86.7% to 60% success rate after fixes <strong>Issue</strong>: PowerShell 5.1 Out-File with UTF-8 encoding creates BOM causing widespread AST parsing failures <strong>Critical Discovery</strong>: BOM (Byte Order Mark) in UTF-8 files breaks PowerShell AST parser in temporary files <strong>Evidence</strong>: All test files showing parse errors after using <code>Out-File -Encoding UTF8</code> in PowerShell 5.1 <strong>Root Cause</strong>: PowerShell 5.1 always creates UTF-8 files with BOM, parser has documented issues with BOM <strong>Resolution</strong>: Use ASCII encoding for simple test files without Unicode characters <strong>Technical Details</strong>: - PowerShell 5.1: <code>Out-File -Encoding UTF8</code> creates UTF-8 <strong>with BOM</strong> - PowerShell 7+: Defaults to UTF-8 <strong>without BOM</strong> - AST parser in PowerShell 5.1 has known issues with BOM in temporary files - BOM causes "string terminator" and parse error symptoms <strong>Implementation Fix</strong>: <div class="language-powershell highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c># WRONG - Creates BOM causing parse errors</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=nv>$content</span> <span class=p>|</span> <span class=nb>Out-File</span> <span class=n>-FilePath</span> <span class=nv>$tempFile</span> <span class=n>-Encoding</span> <span class=n>UTF8</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=c># CORRECT - ASCII encoding prevents BOM issues  </span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=nv>$content</span> <span class=p>|</span> <span class=nb>Out-File</span> <span class=n>-FilePath</span> <span class=nv>$tempFile</span> <span class=n>-Encoding</span> <span class=n>ASCII</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=c># ALTERNATIVE - Set-Content with ASCII</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=nb>Set-Content</span> <span class=n>-Path</span> <span class=nv>$tempFile</span> <span class=n>-Value</span> <span class=nv>$content</span> <span class=n>-Encoding</span> <span class=n>ASCII</span>
</span></code></pre></div> <strong>Best Practices</strong>: 1. Use ASCII encoding for simple PowerShell test files in PowerShell 5.1 2. Reserve UTF8 encoding only for files that need Unicode characters 3. Avoid Out-File with UTF8 encoding for temporary files in PowerShell 5.1 4. Set default parameter: <code>$PSDefaultParameterValues['Out-File:Encoding'] = 'ascii'</code> 5. Test file creation and parsing immediately to catch encoding issues early <strong>Critical Pattern</strong>: Always use ASCII encoding for temporary PowerShell class definition files in PowerShell 5.1 environment</p> <h4 id=learning-239-powershell-51-class-limitations-require-function-based-alternatives-2025-08-28>Learning #239: PowerShell 5.1 Class Limitations Require Function-Based Alternatives (2025-08-28)<a class=headerlink href=#learning-239-powershell-51-class-limitations-require-function-based-alternatives-2025-08-28 title="Permanent link">&para;</a></h4> <p><strong>Context</strong>: Week 2 Day 3 Semantic Analysis - Persistent AST parsing failures confirmed in PowerShell 5.1.22621.5697 Desktop edition <strong>Issue</strong>: PowerShell 5.1 has fundamental limitations with class definitions causing widespread AST parsing failures <strong>Critical Discovery</strong>: PowerShell 5.1 classes described as "second-class citizens" and "an afterthought, arguably the least mature part of the language" <strong>Evidence</strong>: Even simplest PowerShell class syntax fails direct AST parsing in PowerShell 5.1 environment <strong>Root Cause</strong>: PowerShell 5.1 class implementation has known limitations with parse-time compilation and module scope <strong>Resolution</strong>: Implement function-based pattern detection using hashtable objects instead of PowerShell classes <strong>PowerShell 5.1 Class Limitations</strong>: - Classes are "second-class citizens" with significant parsing restrictions - Parse-time type resolution requirements cause compilation failures - Module scope isolation prevents proper class definition loading - Classes can't be unloaded or reloaded in PowerShell 5.1 sessions - External type references must be available at parse-time for IL generation <strong>Function-Based Solution</strong>: <div class="language-powershell highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=c># WRONG - PowerShell classes fail in 5.1</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=n>class</span> <span class=n>PatternMatch</span> <span class=p>{</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>    <span class=no>[string]</span> <span class=nv>$PatternName</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>    <span class=no>[double]</span> <span class=nv>$Confidence</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=p>}</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=c># CORRECT - Function-based hashtable objects</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=k>function</span> <span class=nb>New-PatternMatch</span> <span class=p>{</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>    <span class=k>param</span><span class=p>(</span><span class=no>[string]</span> <span class=nv>$PatternName</span><span class=p>,</span> <span class=no>[double]</span> <span class=nv>$Confidence</span><span class=p>)</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a>    <span class=k>return</span> <span class=p>@{</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a>        <span class=n>PatternName</span> <span class=p>=</span> <span class=nv>$PatternName</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a>        <span class=n>Confidence</span> <span class=p>=</span> <span class=nv>$Confidence</span>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a>        <span class=n>ConfidenceLevel</span> <span class=p>=</span> <span class=k>if</span> <span class=p>(</span><span class=nv>$Confidence</span> <span class=o>-ge</span> <span class=n>0</span><span class=p>.</span><span class=n>8</span><span class=p>)</span> <span class=p>{</span> <span class=s2>&quot;High&quot;</span> <span class=p>}</span> <span class=k>else</span> <span class=p>{</span> <span class=s2>&quot;Medium&quot;</span> <span class=p>}</span>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a>    <span class=p>}</span>
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a><span class=p>}</span>
</span></code></pre></div> <strong>Best Practices</strong>: 1. Use function-based pattern detection following PSScriptAnalyzer model 2. Replace custom classes with hashtable factory functions 3. Use simple PowerShell function definitions for test content (not classes) 4. Implement pattern detection as functions accepting AST parameters 5. Set $DebugPreference = "Continue" for debug output visibility in PowerShell 5.1 <strong>Alternative Approaches</strong>: Consider inline C# classes or compiled assemblies for complex scenarios <strong>Critical Understanding</strong>: PowerShell 5.1 requires function-based approaches for reliable AST analysis and pattern detection</p> <h4 id=learning-240-powershell-double-quoted-here-string-variable-expansion-issues-2025-08-28>Learning #240: PowerShell Double-Quoted Here-String Variable Expansion Issues (2025-08-28)<a class=headerlink href=#learning-240-powershell-double-quoted-here-string-variable-expansion-issues-2025-08-28 title="Permanent link">&para;</a></h4> <p><strong>Context</strong>: Week 2 Day 3 Semantic Analysis - Variable names stripped from all test content causing AST parsing failures <strong>Issue</strong>: Double-quoted here-strings (@"..."@) expand variables to empty strings when variables don't exist in scope <strong>Critical Discovery</strong>: Enhanced debug output revealed all $variables being stripped from class/function definitions <strong>Evidence</strong>: - <code>$Instance</code> → empty string (class property names missing) - <code>$Type, $a, $b</code> → empty strings (parameter names missing)<br> - <code>$this</code> → empty string (method call corruption) <strong>Root Cause</strong>: PowerShell double-quoted here-strings perform variable expansion even when variables undefined <strong>Resolution</strong>: Use single-quoted here-strings (@'...'@) for literal preservation of variable names <strong>Before/After Comparison</strong>: <div class="language-powershell highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=c># WRONG - Double-quoted here-string expands variables</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=nv>$testContent</span> <span class=p>=</span> <span class=sh>@&quot;</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=sh>class TestClass {</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=sh>    [string] $Property</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=sh>    [void] Method([string] $param) {}</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=sh>}</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=sh>&quot;@</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=c># Result: Variables expanded to empty, syntax broken</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=c># CORRECT - Single-quoted here-string preserves literally  </span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=nv>$testContent</span> <span class=p>=</span> <span class=sh>@&#39;</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=sh>class TestClass {</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a><span class=sh>    [string] $Property</span>
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a><span class=sh>    [void] Method([string] $param) {}</span>
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a><span class=sh>}</span>
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a><span class=sh>&#39;@</span>
</span><span id=__span-4-17><a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a><span class=c># Result: All variable names preserved, syntax valid</span>
</span></code></pre></div> <strong>Technical Details</strong>: - Double-quoted here-strings (@"..."@) behave like double-quoted strings with variable expansion - Single-quoted here-strings (@'...'@) behave like single-quoted strings with literal preservation - Variable expansion occurs during string creation, not file writing - Undefined variables expand to empty strings causing syntax corruption <strong>Parse Error Symptoms</strong>: - "Missing expression after unary operator '-not'" (missing variable after -not) - "Parameter declarations are comma-separated list" (missing parameter names) - "Missing ')' in function parameter list" (parameters without names) - "Only one type may be specified on class members" (missing property names) <strong>Best Practices</strong>: 1. Always use single-quoted here-strings (@'...'@) for PowerShell code generation 2. Reserve double-quoted here-strings only when you need variable expansion 3. Test content creation immediately to verify variable preservation 4. Use Write-Debug to verify content before file creation 5. Default to literal strings unless expansion specifically needed <strong>Critical Pattern</strong>: Use @'...'@ for all PowerShell code content generation to prevent variable expansion corruption</p> <h4 id=learning-241-powershell-file-copy-truncation-during-large-script-transfer-2025-08-28>Learning #241: PowerShell File Copy Truncation During Large Script Transfer (2025-08-28)<a class=headerlink href=#learning-241-powershell-file-copy-truncation-during-large-script-transfer-2025-08-28 title="Permanent link">&para;</a></h4> <p><strong>Context</strong>: Week 3 Day 4-5 Testing &amp; Validation - Test-EnhancedDocumentationSystem.ps1 syntax errors <strong>Issue</strong>: Copy-Item operation truncated large PowerShell script from 764 lines to 734 lines <strong>Critical Discovery</strong>: PowerShell Copy-Item can silently truncate large files during transfer operations <strong>Evidence</strong>: Parser errors for missing closing braces and incomplete try-catch blocks after copy <strong>Root Cause</strong>: File copy operation incomplete, missing final 30 lines containing critical script structure <strong>Error Symptoms</strong>: - "The string is missing the terminator" in Write-Error statements - "Missing closing '}' in statement block or type definition"<br> - "Try statement is missing its Catch or Finally block" - Parser reporting line numbers beyond actual file length <strong>Resolution Applied</strong>: <div class="language-powershell highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=c># Verify file integrity after copy operations</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=nv>$originalLines</span> <span class=p>=</span> <span class=p>(</span><span class=nb>Get-Content</span> <span class=nv>$SourcePath</span> <span class=p>|</span> <span class=nb>Measure-Object</span><span class=p>).</span><span class=n>Count</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=nv>$copiedLines</span> <span class=p>=</span> <span class=p>(</span><span class=nb>Get-Content</span> <span class=nv>$DestinationPath</span> <span class=p>|</span> <span class=nb>Measure-Object</span><span class=p>).</span><span class=n>Count</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=k>if</span> <span class=p>(</span><span class=nv>$originalLines</span> <span class=o>-ne</span> <span class=nv>$copiedLines</span><span class=p>)</span> <span class=p>{</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>    <span class=nb>Write-Warning</span> <span class=s2>&quot;File copy incomplete: $originalLines vs $copiedLines lines&quot;</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=p>}</span>
</span></code></pre></div> <strong>Best Practices</strong>: 1. Always verify file line counts after Copy-Item operations on large scripts 2. Use Get-Content | Measure-Object to confirm complete transfer 3. Test PowerShell syntax validation after file operations: Get-Command -Syntax 4. For critical scripts, use alternative copy methods if Copy-Item fails 5. Check file integrity before executing copied PowerShell scripts <strong>Technical Details</strong>: - Issue occurred with 764-line PowerShell script containing Pester v5 test framework - Copy operation stopped at line 734, missing hashtable closure and try-catch completion - PowerShell parser cascades errors when structure is incomplete - Error line numbers can be misleading when file is structurally incomplete <strong>Critical Pattern</strong>: Always validate file integrity after copy operations, especially for large PowerShell test scripts</p> <h4 id=learning-242-pester-configuration-recursive-execution-prevention-2025-08-28>Learning #242: Pester Configuration Recursive Execution Prevention (2025-08-28)<a class=headerlink href=#learning-242-pester-configuration-recursive-execution-prevention-2025-08-28 title="Permanent link">&para;</a></h4> <p><strong>Context</strong>: Week 3 Day 4-5 Testing &amp; Validation - Test-EnhancedDocumentationSystem.ps1 call depth overflow <strong>Issue</strong>: Pester configuration with <code>$config.Run.Path = $PSCommandPath</code> causes infinite recursion when script executes itself <strong>Critical Discovery</strong>: Setting Run.Path to current script in self-executing test scripts creates recursive loop <strong>Evidence</strong>: Call depth overflow at Describe block, Pester discovering 0 tests, 50+ repeated test starts <strong>Root Cause</strong>: Script configures Pester to run itself, then calls Invoke-Pester, causing infinite self-execution <strong>Error Pattern</strong>: - System.Management.Automation.ScriptCallDepthException at Describe block - "Discovery found 0 tests" despite valid Describe/Context/It structure<br> - Multiple repeated script header outputs indicating loop - Stack overflow in Pester.psm1 line 10202 at Describe function <strong>Resolution</strong>: Remove <code>$config.Run.Path = $PSCommandPath</code> and let Pester auto-discover tests <strong>Correct Configuration</strong>: <div class="language-powershell highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=c># WRONG - Causes recursive execution</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=nv>$config</span><span class=p>.</span><span class=n>Run</span><span class=p>.</span><span class=n>Path</span> <span class=p>=</span> <span class=nv>$PSCommandPath</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=nv>$testResults</span> <span class=p>=</span> <span class=nb>Invoke-Pester</span> <span class=n>-Configuration</span> <span class=nv>$config</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=c># CORRECT - Auto-discovery without recursion</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=nv>$config</span> <span class=p>=</span> <span class=nb>New-PesterConfiguration</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=c># Don&#39;t set Run.Path - let Pester discover tests in current script</span>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=nv>$config</span><span class=p>.</span><span class=n>Run</span><span class=p>.</span><span class=n>PassThru</span> <span class=p>=</span> <span class=nv>$true</span>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=nv>$testResults</span> <span class=p>=</span> <span class=nb>Invoke-Pester</span> <span class=n>-Configuration</span> <span class=nv>$config</span>
</span></code></pre></div> <strong>Best Practices</strong>: 1. Never set Run.Path to $PSCommandPath in self-executing test scripts 2. Let Pester auto-discover tests in the current script context 3. Use Run.Path only when testing external scripts from a runner script 4. Add debug logging to trace recursive execution issues 5. Verify Pester configuration doesn't create self-referential loops <strong>Technical Details</strong>: - Pester Run.Path tells framework which files to execute for testing - Setting it to current script creates execution loop when Invoke-Pester called - Auto-discovery mode lets Pester find Describe blocks without re-execution - Call depth overflow occurs when PowerShell stack exceeds maximum recursion depth <strong>Critical Pattern</strong>: Never configure Pester to re-execute the script it's already running from</p> <h4 id=learning-243-pester-self-executing-test-script-infinite-recursion-2025-08-28>Learning #243: Pester Self-Executing Test Script Infinite Recursion (2025-08-28)<a class=headerlink href=#learning-243-pester-self-executing-test-script-infinite-recursion-2025-08-28 title="Permanent link">&para;</a></h4> <p><strong>Context</strong>: Week 3 Day 4-5 Testing &amp; Validation - Test-EnhancedDocumentationSystem.ps1 call depth overflow persistence <strong>Issue</strong>: Self-executing test scripts that contain both test definitions and Invoke-Pester calls create infinite recursion <strong>Critical Discovery</strong>: Scripts with Describe blocks AND Invoke-Pester calls cause recursive discovery loop <strong>Evidence</strong>: - Call depth overflow at Describe block during discovery phase - "Starting discovery in 1 files" repeated endlessly - Script header output repeated 50+ times indicating infinite loop - Stack trace shows Invoke-Pester → Describe → Invoke-Pester recursion <strong>Root Cause</strong>: During Pester discovery phase, script re-executes and hits Invoke-Pester call again <strong>Error Flow</strong>: 1. Orchestrator executes Test-Script.ps1 2. Script contains Describe blocks + Invoke-Pester call 3. Pester discovery phase re-executes entire script 4. Script hits Invoke-Pester call again during discovery 5. New Pester instance starts discovery of same script 6. Infinite recursion until call depth overflow <strong>Resolution</strong>: Separate test definitions from test execution <strong>Correct Architecture</strong>: <div class="language-powershell highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=c># TEST DEFINITIONS FILE (Test-Something.ps1)</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=c># Contains ONLY Describe/Context/It blocks - NO Invoke-Pester</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=n>Describe</span> <span class=s2>&quot;My Tests&quot;</span> <span class=p>{</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>    <span class=n>It</span> <span class=s2>&quot;Should work&quot;</span> <span class=p>{</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>        <span class=c># Test logic</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>    <span class=p>}</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=p>}</span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=c># No Invoke-Pester call in this file</span>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=c># TEST RUNNER FILE (Run-SomethingTests.ps1) </span>
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=c># Contains ONLY Invoke-Pester call - NO test definitions</span>
</span><span id=__span-7-13><a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a>
</span><span id=__span-7-14><a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a><span class=nv>$config</span> <span class=p>=</span> <span class=nb>New-PesterConfiguration</span>
</span><span id=__span-7-15><a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a><span class=nv>$config</span><span class=p>.</span><span class=n>Run</span><span class=p>.</span><span class=n>Path</span> <span class=p>=</span> <span class=s2>&quot;Test-Something.ps1&quot;</span>
</span><span id=__span-7-16><a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a><span class=nv>$testResults</span> <span class=p>=</span> <span class=nb>Invoke-Pester</span> <span class=n>-Configuration</span> <span class=nv>$config</span>
</span></code></pre></div> <strong>Best Practices</strong>: 1. Never combine test definitions and Invoke-Pester calls in same script 2. Use separate runner script for orchestrator execution 3. Test definition files contain only Describe/Context/It blocks 4. Runner scripts handle Pester configuration and execution 5. Remove all Invoke-Pester calls from scripts containing Describe blocks <strong>Technical Details</strong>: - Pester discovery phase executes entire script looking for test definitions - Any Invoke-Pester calls encountered during discovery trigger new Pester instances - Stack overflow occurs when recursive depth exceeds PowerShell limits - Error persists despite removing $config.Run.Path because script still calls Invoke-Pester <strong>Critical Pattern</strong>: Separate test definitions from test execution to prevent Pester recursive discovery loops</p> <h4 id=learning-244-pester-conditional-describe-block-discovery-prevention-2025-08-28>Learning #244: Pester Conditional Describe Block Discovery Prevention (2025-08-28)<a class=headerlink href=#learning-244-pester-conditional-describe-block-discovery-prevention-2025-08-28 title="Permanent link">&para;</a></h4> <p><strong>Context</strong>: Week 3 Day 4-5 Testing &amp; Validation - Test discovery finding 0 tests despite resolved recursion <strong>Issue</strong>: Describe blocks wrapped in conditional if statements prevent Pester v5 discovery phase execution <strong>Critical Discovery</strong>: Parameters and variables unavailable during Pester discovery phase cause if conditions to fail <strong>Evidence</strong>: - Test script with if ($TestScope -eq "All") wrapping Describe blocks - Pester discovery finds 0 tests despite valid Describe/Context/It structure - Parameters like $TestScope undefined during discovery phase - Conditional logic prevents Describe blocks from executing during discovery <strong>Root Cause</strong>: Pester v5 discovery phase loads script but doesn't pass parameters or initialize variables <strong>Error Pattern</strong>: - "Discovery found 0 tests" despite valid test structure - Describe blocks wrapped in if statements checking script parameters - Parameters undefined during discovery, conditions evaluate false - Test blocks never execute during discovery phase, so not registered <strong>Resolution</strong>: Remove conditional wrappers, use Pester built-in filtering instead <strong>Before (Wrong)</strong>: <div class="language-powershell highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=k>param</span><span class=p>(</span><span class=no>[string]</span><span class=nv>$TestScope</span> <span class=p>=</span> <span class=s2>&quot;All&quot;</span><span class=p>)</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=k>if</span> <span class=p>(</span><span class=nv>$TestScope</span> <span class=o>-eq</span> <span class=s2>&quot;All&quot;</span> <span class=o>-or</span> <span class=nv>$TestScope</span> <span class=o>-eq</span> <span class=s2>&quot;CPG&quot;</span><span class=p>)</span> <span class=p>{</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>    <span class=n>Describe</span> <span class=s2>&quot;CPG Tests&quot;</span> <span class=p>{</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>        <span class=c># Tests here</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>    <span class=p>}</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=p>}</span>
</span></code></pre></div> <strong>After (Correct)</strong>: <div class="language-powershell highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=c># No parameters in test definitions file</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=n>Describe</span> <span class=s2>&quot;CPG Tests&quot;</span> <span class=n>-Tag</span> <span class=s2>&quot;CPG&quot;</span> <span class=p>{</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>    <span class=c># Tests here</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=p>}</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=c># Use runner script for filtering:</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=c># $config.Filter.Tag = &quot;CPG&quot;  # In runner script</span>
</span></code></pre></div> <strong>Best Practices</strong>: 1. Never wrap Describe blocks in conditional logic based on script parameters 2. Use Pester built-in filtering mechanisms (tags, names) for test selection 3. Test definitions files should have no parameters or conditional logic 4. Runner scripts handle test filtering and configuration 5. All Describe blocks must execute during discovery phase to be registered <strong>Technical Details</strong>: - Pester discovery phase executes script top-to-bottom but doesn't initialize parameters - Script variables and parameters are undefined during discovery - if statements around Describe blocks prevent registration during discovery - Use -Tag parameters on Describe blocks for filtering instead of if conditions <strong>Critical Pattern</strong>: Never use conditional logic around Describe blocks - use Pester filtering mechanisms instead</p> <h4 id=learning-245-pester-script-variable-null-array-prevention-in-test-conditions-2025-08-28>Learning #245: Pester Script Variable Null Array Prevention in Test Conditions (2025-08-28)<a class=headerlink href=#learning-245-pester-script-variable-null-array-prevention-in-test-conditions-2025-08-28 title="Permanent link">&para;</a></h4> <p><strong>Context</strong>: Week 3 Day 4-5 Testing &amp; Validation - Test execution with "Cannot index into a null array" runtime error <strong>Issue</strong>: Test conditions accessing $script:VariableName hashtables fail with null array indexing when BeforeAll initialization incomplete <strong>Critical Discovery</strong>: Pester test conditions execute even when BeforeAll blocks fail, causing null reference errors <strong>Evidence</strong>: - "Cannot index into a null array" at line 121 in test condition - Test condition: -Skip:(-not $script:CPGModulesAvailable['ModuleName']) - BeforeAll block initializes $script:CPGModulesAvailable but fails before completion - Test framework attempts to evaluate skip condition on null hashtable <strong>Root Cause</strong>: BeforeAll block failures leave script variables in undefined state, test conditions try to access null hashtables <strong>Resolution</strong>: Initialize script variables with defensive defaults before complex logic <strong>Best Practices</strong>: 1. Initialize script hashtables with all expected keys set to safe defaults 2. Use defensive defaults before attempting complex initialization logic<br> 3. Ensure test conditions can safely access hashtable keys even on BeforeAll failure 4. Add comprehensive error handling in module availability testing 5. Use try-catch around individual module tests, not entire initialization <strong>Critical Pattern</strong>: Always initialize script hashtables with defensive defaults before complex population logic</p> <h4 id=learning-246-pester-discovery-phase-script-variable-availability-2025-08-28>Learning #246: Pester Discovery Phase Script Variable Availability (2025-08-28)<a class=headerlink href=#learning-246-pester-discovery-phase-script-variable-availability-2025-08-28 title="Permanent link">&para;</a></h4> <p><strong>Context</strong>: Week 3 Day 4-5 Testing &amp; Validation - Null array error persisting despite BeforeAll defensive initialization <strong>Issue</strong>: Script variables defined in BeforeAll blocks are undefined during Pester discovery phase when test conditions evaluated <strong>Critical Discovery</strong>: Pester v5 discovery phase evaluates test conditions BEFORE executing any BeforeAll blocks <strong>Evidence</strong>: - "Cannot index into a null array" at test condition -Skip:(-not $script:ModuleVar['Key']) - BeforeAll block initializes variables but error occurs during discovery - Test conditions with script variable access failing during discovery evaluation - Variables must exist during discovery for proper test registration <strong>Root Cause</strong>: Discovery phase evaluates entire script including test conditions before any BeforeAll execution <strong>Resolution</strong>: Initialize all script variables at top-level scope before any Describe blocks <strong>Timing Analysis</strong>: <div class="language-text highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>Discovery Phase (Variables Must Exist):
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>1. Script loaded and executed top-to-bottom
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>2. Test conditions evaluated: -Skip:(-not $script:Variable)
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>3. Describe/Context/It blocks registered
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>4. Variables accessed HERE → Must be initialized
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a>Run Phase (BeforeAll Executes):
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a>5. BeforeAll blocks execute
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>6. Test logic runs
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>7. AfterAll blocks execute
</span></code></pre></div> <strong>Correct Pattern</strong>: <div class="language-powershell highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=c># TOP-LEVEL INITIALIZATION (Discovery Phase Available)</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=nv>$script:ModuleStatus</span> <span class=p>=</span> <span class=p>@{</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>    <span class=s1>&#39;Module1&#39;</span> <span class=p>=</span> <span class=nv>$false</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>    <span class=s1>&#39;Module2&#39;</span> <span class=p>=</span> <span class=nv>$false</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=p>}</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=n>Describe</span> <span class=s2>&quot;Tests&quot;</span> <span class=p>{</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>    <span class=n>BeforeAll</span> <span class=p>{</span>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a>        <span class=c># Update variables during run phase</span>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>        <span class=nv>$script:ModuleStatus</span><span class=p>[</span><span class=s1>&#39;Module1&#39;</span><span class=p>]</span> <span class=p>=</span> <span class=nb>Test-ModuleAvailability</span>
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a>    <span class=p>}</span>
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a>
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a>    <span class=c># Condition evaluates during discovery - variable must already exist</span>
</span><span id=__span-11-14><a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a>    <span class=n>It</span> <span class=s2>&quot;Test&quot;</span> <span class=n>-Skip</span><span class=p>:(</span><span class=o>-not</span> <span class=nv>$script:ModuleStatus</span><span class=p>[</span><span class=s1>&#39;Module1&#39;</span><span class=p>])</span> <span class=p>{</span>
</span><span id=__span-11-15><a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a>        <span class=c># Test logic</span>
</span><span id=__span-11-16><a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a>    <span class=p>}</span>
</span><span id=__span-11-17><a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a><span class=p>}</span>
</span></code></pre></div> <strong>Best Practices</strong>: 1. Initialize ALL script variables at script top-level before any Describe blocks 2. Use BeforeAll blocks only to UPDATE variables, not initialize them 3. Ensure test conditions can safely access variables during discovery phase 4. Set conservative defaults (false/null) that promote test skipping over failures 5. Never rely on BeforeAll execution for variables used in test conditions <strong>Technical Details</strong>: - Discovery phase happens before any BeforeAll block execution - Test conditions (-Skip, -TestCases) evaluated during discovery to register tests - Script variables accessed in conditions must exist at script load time - BeforeAll blocks execute later during run phase and can update values <strong>Critical Pattern</strong>: Script variables used in test conditions must be initialized at top-level scope for discovery phase availability</p> <h4 id=learning-247-pester-function-scope-issues-in-test-execution-context-2025-08-28>Learning #247: Pester Function Scope Issues in Test Execution Context (2025-08-28)<a class=headerlink href=#learning-247-pester-function-scope-issues-in-test-execution-context-2025-08-28 title="Permanent link">&para;</a></h4> <p><strong>Context</strong>: Week 3 Day 4-5 Testing &amp; Validation - Function recognition errors during test execution <strong>Issue</strong>: Custom functions defined in test files are not available during Pester test execution context <strong>Critical Discovery</strong>: Functions defined in test file regions may not be accessible during It block execution <strong>Evidence</strong>: - "The term 'Measure-TestPerformance' is not recognized as the name of a cmdlet, function" error - Function defined in #region Helper Functions but not accessible in test execution - Tests discovering and executing but failing on custom function calls - Built-in PowerShell functions (Measure-Command) work correctly <strong>Root Cause</strong>: Pester v5 test execution context may not include functions defined in the test file itself <strong>Resolution</strong>: Replace custom helper functions with direct PowerShell code in test blocks <strong>Before (Problematic)</strong>: <div class="language-powershell highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=k>function</span> <span class=nb>Measure-TestPerformance</span> <span class=p>{</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>    <span class=k>param</span><span class=p>(</span><span class=no>[string]</span><span class=nv>$TestName</span><span class=p>,</span> <span class=no>[scriptblock]</span><span class=nv>$ScriptBlock</span><span class=p>)</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>    <span class=c># Custom logic</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=p>}</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=n>It</span> <span class=s2>&quot;Test&quot;</span> <span class=p>{</span>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a>    <span class=nb>Measure-TestPerformance</span> <span class=n>-TestName</span> <span class=s2>&quot;Test&quot;</span> <span class=n>-ScriptBlock</span> <span class=p>{</span>
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a>        <span class=c># Test logic</span>
</span><span id=__span-12-9><a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a>    <span class=p>}</span>
</span><span id=__span-12-10><a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=p>}</span>
</span></code></pre></div> <strong>After (Working)</strong>: <div class="language-powershell highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=n>It</span> <span class=s2>&quot;Test&quot;</span> <span class=p>{</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>    <span class=c># Direct test logic without custom function calls</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>    <span class=nv>$stopwatch</span> <span class=p>=</span> <span class=no>[System.Diagnostics.Stopwatch]</span><span class=p>::</span><span class=n>StartNew</span><span class=p>()</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>    <span class=c># Test logic here</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>    <span class=nv>$stopwatch</span><span class=p>.</span><span class=n>Stop</span><span class=p>()</span>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a>    <span class=c># Assertions here</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=p>}</span>
</span></code></pre></div> <strong>Best Practices</strong>: 1. Use built-in PowerShell cmdlets (Measure-Command) instead of custom functions 2. Keep test logic simple and self-contained within It blocks 3. Avoid custom helper functions that may not be in test execution scope 4. Use direct PowerShell code rather than custom abstractions in test files 5. Test function availability before using in test execution context <strong>Technical Details</strong>: - Pester v5 execution context may isolate test blocks from file-level function definitions - Built-in PowerShell functions and cmdlets remain available - Custom functions in test files may not be loaded in test execution scope - Function scope issues different from variable scope issues <strong>Critical Pattern</strong>: Keep test logic simple and use built-in PowerShell features rather than custom functions</p> <h4 id=learning-248-module-import-testing-in-pester-context-requires-permissive-error-handling-2025-08-28>Learning #248: Module Import Testing in Pester Context Requires Permissive Error Handling (2025-08-28)<a class=headerlink href=#learning-248-module-import-testing-in-pester-context-requires-permissive-error-handling-2025-08-28 title="Permanent link">&para;</a></h4> <p><strong>Context</strong>: Week 3 Day 4-5 Testing &amp; Validation - modules exist and import manually but Test-ModuleAvailable reports unavailable <strong>Issue</strong>: Module availability testing functions using ErrorAction Stop treat warnings as failures, incorrectly reporting available modules as unavailable <strong>Critical Discovery</strong>: PowerShell modules often import successfully with warnings, but strict error handling catches warnings as failures <strong>Evidence</strong>: - Manual import of CPG-ThreadSafeOperations.psm1 succeeds with warning messages - Manual import of Templates-PerLanguage.psm1 succeeds without errors<br> - Test-ModuleAvailable function with ErrorAction Stop reports both as unavailable - 27 of 28 tests skipped due to false negative module detection <strong>Root Cause</strong>: ErrorAction Stop treats warnings as terminating errors, causing successful imports with warnings to be marked as failures <strong>Resolution</strong>: Use permissive error handling with SilentlyContinue and PassThru validation <strong>Before (Too Strict)</strong>: <div class="language-powershell highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=k>function</span> <span class=nb>Test-ModuleAvailable</span> <span class=p>{</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>    <span class=k>try</span> <span class=p>{</span>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>        <span class=nb>Import-Module</span> <span class=nv>$ModulePath</span> <span class=n>-Force</span> <span class=n>-ErrorAction</span> <span class=n>Stop</span>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a>        <span class=k>return</span> <span class=nv>$true</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>    <span class=p>}</span>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a>    <span class=k>catch</span> <span class=p>{</span>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a>        <span class=k>return</span> <span class=nv>$false</span>  <span class=c># Treats warnings as failures</span>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a>    <span class=p>}</span>
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=p>}</span>
</span></code></pre></div> <strong>After (Correctly Permissive)</strong>: <div class="language-powershell highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=k>function</span> <span class=nb>Test-ModuleAvailable</span> <span class=p>{</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>    <span class=k>try</span> <span class=p>{</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>        <span class=nv>$module</span> <span class=p>=</span> <span class=nb>Import-Module</span> <span class=nv>$ModulePath</span> <span class=n>-Force</span> <span class=n>-PassThru</span> <span class=n>-ErrorAction</span> <span class=n>SilentlyContinue</span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>        <span class=k>if</span> <span class=p>(</span><span class=nv>$module</span><span class=p>)</span> <span class=p>{</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>            <span class=k>return</span> <span class=nv>$true</span>  <span class=c># Module object returned = success</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>        <span class=p>}</span>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a>        <span class=c># Fallback: Check if functions available</span>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a>        <span class=nb>Get-Command</span> <span class=n>-Module</span> <span class=nv>$ModuleName</span> <span class=n>-ErrorAction</span> <span class=n>SilentlyContinue</span> <span class=p>|</span> <span class=nb>Out-Null</span>
</span><span id=__span-15-9><a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a>        <span class=k>return</span> <span class=p>$?</span>  <span class=c># $? = true if previous command succeeded</span>
</span><span id=__span-15-10><a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a>    <span class=p>}</span>
</span><span id=__span-15-11><a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a>    <span class=k>catch</span> <span class=p>{</span>
</span><span id=__span-15-12><a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a>        <span class=k>return</span> <span class=nv>$false</span>
</span><span id=__span-15-13><a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a>    <span class=p>}</span>
</span><span id=__span-15-14><a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a><span class=p>}</span>
</span></code></pre></div> <strong>Best Practices</strong>: 1. Use ErrorAction SilentlyContinue for module availability testing 2. Use PassThru to get actual module object for validation 3. Implement fallback checks with Get-Command for additional validation 4. Don't treat warnings as failures when testing module availability 5. Distinguish between "module doesn't exist" vs "module imports with warnings" <strong>Technical Details</strong>: - PowerShell modules frequently emit warnings during import (dependency messages, etc.) - ErrorAction Stop converts warnings to terminating exceptions - Successful module import with warnings still populates module functions - PassThru parameter returns module object which can be validated <strong>Critical Pattern</strong>: Use permissive error handling for module availability testing to avoid false negatives from warning messages</p> <h4 id=learning-249-pester-v5-selective-beforeall-execution-optimization-2025-08-28>Learning #249: Pester v5 Selective BeforeAll Execution Optimization (2025-08-28)<a class=headerlink href=#learning-249-pester-v5-selective-beforeall-execution-optimization-2025-08-28 title="Permanent link">&para;</a></h4> <p><strong>Context</strong>: Week 3 Day 4-5 Testing &amp; Validation - BeforeAll blocks not executing for CPG/LLM/Templates causing 27 test skips <strong>Issue</strong>: Pester v5 optimizes execution by skipping BeforeAll blocks when all tests in that category would be skipped anyway <strong>Critical Discovery</strong>: When all tests have -Skip:$true conditions, Pester doesn't execute the BeforeAll blocks for that category <strong>Evidence</strong>: - Red alert markers confirm only Performance BeforeAll executes during run phase - CPG/LLM/Templates BeforeAll blocks never reached (no red alert markers) - All modules default to <span class=arithmatex>\(false causing -Skip:\)</span>true for all tests in those categories<br> - Pester optimization: "Setups and teardowns are skipped when the current tree won't result in any test being run" <strong>Root Cause</strong>: Pester v5 selective execution optimization prevents BeforeAll when no tests would execute <strong>Resolution</strong>: Test module availability during script initialization (not BeforeAll) so skip conditions are accurate <strong>Before (Problematic)</strong>: <div class="language-powershell highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=c># Variables default to false</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=nv>$script:ModuleAvailable</span> <span class=p>=</span> <span class=nv>$false</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=n>Describe</span> <span class=s2>&quot;Tests&quot;</span> <span class=p>{</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a>    <span class=n>BeforeAll</span> <span class=p>{</span>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a>        <span class=c># This never executes because all tests skip</span>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a>        <span class=nv>$script:ModuleAvailable</span> <span class=p>=</span> <span class=nb>Test-ModuleActuallyAvailable</span>
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a>    <span class=p>}</span>
</span><span id=__span-16-9><a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a>
</span><span id=__span-16-10><a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a>    <span class=n>It</span> <span class=s2>&quot;Test&quot;</span> <span class=n>-Skip</span><span class=p>:(</span><span class=o>-not</span> <span class=nv>$script:ModuleAvailable</span><span class=p>)</span> <span class=p>{</span>
</span><span id=__span-16-11><a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a>        <span class=c># Always skips because variable stays false</span>
</span><span id=__span-16-12><a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a>    <span class=p>}</span>
</span><span id=__span-16-13><a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a><span class=p>}</span>
</span></code></pre></div> <strong>After (Working)</strong>: <div class="language-powershell highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=c># Test availability during script initialization</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=nv>$script:ModuleAvailable</span> <span class=p>=</span> <span class=nb>Test-ModuleActuallyAvailable</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=n>Describe</span> <span class=s2>&quot;Tests&quot;</span> <span class=p>{</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a>    <span class=n>BeforeAll</span> <span class=p>{</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a>        <span class=c># Now executes because some tests may run</span>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a>        <span class=c># Additional setup here</span>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a>    <span class=p>}</span>
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a>
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a>    <span class=n>It</span> <span class=s2>&quot;Test&quot;</span> <span class=n>-Skip</span><span class=p>:(</span><span class=o>-not</span> <span class=nv>$script:ModuleAvailable</span><span class=p>)</span> <span class=p>{</span>
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a>        <span class=c># Skips only if actually unavailable</span>
</span><span id=__span-17-12><a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a>    <span class=p>}</span>
</span><span id=__span-17-13><a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a><span class=p>}</span>
</span></code></pre></div> <strong>Best Practices</strong>: 1. Test module/dependency availability during script initialization for accurate -Skip conditions 2. Use file existence (Test-Path) for basic availability checking during script load 3. Reserve BeforeAll blocks for runtime setup that needs to execute 4. Understand Pester v5 optimization skips BeforeAll when all tests would skip 5. Ensure at least some tests are runnable to trigger BeforeAll execution <strong>Technical Details</strong>: - Pester v5 evaluates skip conditions during discovery to optimize execution - BeforeAll blocks are skipped when Pester determines no tests will run in that category - Script-level initialization runs during discovery and can populate skip condition variables <strong>Critical Pattern</strong>: Test dependencies during script initialization to enable accurate Pester v5 skip conditions and BeforeAll execution</p> <h4 id=learning-250-pester-v5-variable-scope-isolation-between-discovery-and-run-phases-2025-08-28>Learning #250: Pester v5 Variable Scope Isolation Between Discovery and Run Phases (2025-08-28)<a class=headerlink href=#learning-250-pester-v5-variable-scope-isolation-between-discovery-and-run-phases-2025-08-28 title="Permanent link">&para;</a></h4> <p><strong>Context</strong>: Week 3 Day 4-5 Testing &amp; Validation - script variables available during discovery but NULL during run phase BeforeAll execution <strong>Issue</strong>: Pester v5 isolates variable scope between discovery and run phases, causing script variables to be unavailable in BeforeAll blocks <strong>Critical Discovery</strong>: Variables initialized during script load are accessible during discovery but not during run phase execution <strong>Evidence</strong>: - Script initialization shows all modules as FOUND during discovery phase - BeforeAll blocks show "CPGModulesAvailable: NULL" during run phase - Variable scope isolation prevents BeforeAll access to script-level variables <strong>Root Cause</strong>: Pester v5 architecture isolates discovery and run phases, script variables don't persist between phases <strong>Resolution</strong>: Use BeforeDiscovery blocks to ensure variables available in both discovery and run phases <strong>Best Practices</strong>: 1. Use BeforeDiscovery blocks to ensure variables persist across Pester phases 2. Re-initialize critical variables in BeforeDiscovery for run phase availability 3. Don't rely on script-level initialization for BeforeAll variable access 4. Test variable availability in BeforeAll blocks with defensive null checking <strong>Critical Pattern</strong>: Use BeforeDiscovery blocks to ensure script variables available during Pester v5 run phase execution</p> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2025 Unity Claude Automation </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/Unity-Claude-Automation target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://discord.gg/unity-claude target=_blank rel=noopener title=discord.gg class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"/></svg> </a> <a href=mailto:team@unity-claude.dev target=_blank rel=noopener title class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M536.4-26.3c9.8-3.5 20.6-1 28 6.3s9.8 18.2 6.3 28l-178 496.9c-5 13.9-18.1 23.1-32.8 23.1-14.2 0-27-8.6-32.3-21.7l-64.2-158c-4.5-11-2.5-23.6 5.2-32.6l94.5-112.4c5.1-6.1 4.7-15-.9-20.6s-14.6-6-20.6-.9l-112.4 94.3c-9.1 7.6-21.6 9.6-32.6 5.2L38.1 216.8c-13.1-5.3-21.7-18.1-21.7-32.3 0-14.7 9.2-27.8 23.1-32.8z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">Accept</button> <label class=md-button for=__settings>Manage settings</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.path", "navigation.prune", "navigation.indexes", "navigation.top", "navigation.footer", "toc.follow", "toc.integrate", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate", "content.code.select", "content.tabs.link", "content.tooltips", "content.action.edit", "content.action.view"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": {"Automation": "automation", "Claude": "claude", "PowerShell": "powershell", "Python": "python", "Unity": "unity"}, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.92b07e13.min.js></script> <script src=../../javascripts/mathjax.js></script> <script src=https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>