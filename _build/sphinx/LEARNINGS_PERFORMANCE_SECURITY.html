

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Performance and Security - Unity-Claude Automation &mdash; Unity-Claude-Automation 3.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=acc74ff5"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2b3e50" >

          
          
          <a href="index.html" class="icon icon-home">
            Unity-Claude-Automation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Performance and Security - Unity-Claude Automation</a><ul>
<li><a class="reference internal" href="#performance-learnings">🚀 Performance Learnings</a><ul>
<li><a class="reference internal" href="#runspace-vs-psjob-performance-documented">19. Runspace vs PSJob Performance (📝 DOCUMENTED)</a></li>
<li><a class="reference internal" href="#parallel-overhead-critical">20. Parallel Overhead (⚠️ CRITICAL)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#http-server-implementation-learnings">🔧 HTTP Server Implementation Learnings</a><ul>
<li><a class="reference internal" href="#httplistener-async-handling-issues-critical">36. HttpListener Async Handling Issues (⚠️ CRITICAL)</a></li>
<li><a class="reference internal" href="#port-conflicts-with-http-sys-documented">37. Port Conflicts with HTTP.sys (📝 DOCUMENTED)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#common-pitfalls-to-avoid">🐛 Common Pitfalls to Avoid</a><ul>
<li><a class="reference internal" href="#assuming-api-methods-exist">21. Assuming API Methods Exist</a></li>
<li><a class="reference internal" href="#forgetting-execution-policy">22. Forgetting Execution Policy</a></li>
<li><a class="reference internal" href="#not-checking-claude-cli-installation">23. Not Checking Claude CLI Installation</a></li>
<li><a class="reference internal" href="#ignoring-unity-project-state">24. Ignoring Unity Project State</a></li>
<li><a class="reference internal" href="#module-path-issues">25. Module Path Issues</a></li>
</ul>
</li>
<li><a class="reference internal" href="#success-patterns">📈 Success Patterns</a><ul>
<li><a class="reference internal" href="#incremental-testing">26. Incremental Testing</a></li>
<li><a class="reference internal" href="#defensive-coding">27. Defensive Coding</a></li>
<li><a class="reference internal" href="#comprehensive-logging">28. Comprehensive Logging</a></li>
<li><a class="reference internal" href="#graceful-degradation">29. Graceful Degradation</a></li>
<li><a class="reference internal" href="#user-feedback">30. User Feedback</a></li>
</ul>
</li>
<li><a class="reference internal" href="#performance-optimization-patterns">⚡ Performance Optimization Patterns</a><ul>
<li><a class="reference internal" href="#powershell-performance-best-practices">PowerShell Performance Best Practices</a></li>
<li><a class="reference internal" href="#parallel-processing-guidelines">Parallel Processing Guidelines</a></li>
<li><a class="reference internal" href="#memory-management-patterns">Memory Management Patterns</a></li>
</ul>
</li>
<li><a class="reference internal" href="#security-patterns">🔒 Security Patterns</a><ul>
<li><a class="reference internal" href="#input-validation-and-sanitization">Input Validation and Sanitization</a></li>
<li><a class="reference internal" href="#credential-management">Credential Management</a></li>
<li><a class="reference internal" href="#logging-security">Logging Security</a></li>
</ul>
</li>
<li><a class="reference internal" href="#future-considerations">🔮 Future Considerations</a><ul>
<li><a class="reference internal" href="#claude-cli-updates">31. Claude CLI Updates</a></li>
<li><a class="reference internal" href="#unity-version-changes">32. Unity Version Changes</a></li>
<li><a class="reference internal" href="#powershell-7-migration">33. PowerShell 7 Migration</a></li>
<li><a class="reference internal" href="#api-model-evolution">34. API Model Evolution</a></li>
<li><a class="reference internal" href="#security-requirements">35. Security Requirements</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2b3e50" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Unity-Claude-Automation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Performance and Security - Unity-Claude Automation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/LEARNINGS_PERFORMANCE_SECURITY.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="performance-and-security-unity-claude-automation">
<h1>Performance and Security - Unity-Claude Automation<a class="headerlink" href="#performance-and-security-unity-claude-automation" title="Link to this heading"></a></h1>
<p><em>Performance optimization, security patterns, and common pitfalls with solutions</em>
<em>Last Updated: 2025-08-19</em></p>
<section id="performance-learnings">
<h2>🚀 Performance Learnings<a class="headerlink" href="#performance-learnings" title="Link to this heading"></a></h2>
<section id="runspace-vs-psjob-performance-documented">
<h3>19. Runspace vs PSJob Performance (📝 DOCUMENTED)<a class="headerlink" href="#runspace-vs-psjob-performance-documented" title="Link to this heading"></a></h3>
<p><strong>Issue</strong>: Start-Job very slow
<strong>Discovery</strong>: ThreadJob 3x faster than Start-Job
<strong>Evidence</strong>: Startup: ThreadJob 36ms vs PSJob 148ms
<strong>Resolution</strong>: Use ThreadJob module for parallelization
<strong>Critical Learning</strong>: Choose right tool for parallel execution</p>
</section>
<section id="parallel-overhead-critical">
<h3>20. Parallel Overhead (⚠️ CRITICAL)<a class="headerlink" href="#parallel-overhead-critical" title="Link to this heading"></a></h3>
<p><strong>Issue</strong>: Parallel slower for simple operations
<strong>Discovery</strong>: Overhead can be 500x for trivial tasks
<strong>Evidence</strong>: Simple loop: 1ms serial vs 500ms parallel
<strong>Resolution</strong>: Only parallelize substantial work
<strong>Critical Learning</strong>: Measure before parallelizing</p>
</section>
</section>
<section id="http-server-implementation-learnings">
<h2>🔧 HTTP Server Implementation Learnings<a class="headerlink" href="#http-server-implementation-learnings" title="Link to this heading"></a></h2>
<section id="httplistener-async-handling-issues-critical">
<h3>36. HttpListener Async Handling Issues (⚠️ CRITICAL)<a class="headerlink" href="#httplistener-async-handling-issues-critical" title="Link to this heading"></a></h3>
<p><strong>Issue</strong>: Async HttpListener methods don’t work properly in PowerShell
<strong>Discovery</strong>: BeginGetContext/EndGetContext with WaitOne fails to process requests
<strong>Evidence</strong>: Requests hang indefinitely despite port being open
<strong>Resolution</strong>: Use synchronous GetContext() blocking calls instead
<strong>Critical Learning</strong>: For PowerShell HTTP servers, always use synchronous approach
<strong>Working Example</strong>: Start-SimpleServer.ps1 using GetContext() directly</p>
</section>
<section id="port-conflicts-with-http-sys-documented">
<h3>37. Port Conflicts with HTTP.sys (📝 DOCUMENTED)<a class="headerlink" href="#port-conflicts-with-http-sys-documented" title="Link to this heading"></a></h3>
<p><strong>Issue</strong>: Ports remain reserved in HTTP.sys after improper cleanup
<strong>Discovery</strong>: Ports 5556-5557 stuck even after stopping listeners
<strong>Evidence</strong>: “existing registration on the machine” errors
<strong>Resolution</strong>: Use different ports or restart PowerShell/system
<strong>Critical Learning</strong>: Always properly dispose HttpListener objects</p>
</section>
</section>
<section id="common-pitfalls-to-avoid">
<h2>🐛 Common Pitfalls to Avoid<a class="headerlink" href="#common-pitfalls-to-avoid" title="Link to this heading"></a></h2>
<section id="assuming-api-methods-exist">
<h3>21. Assuming API Methods Exist<a class="headerlink" href="#assuming-api-methods-exist" title="Link to this heading"></a></h3>
<p><strong>Issue</strong>: Calling non-existent Unity API methods
<strong>Prevention</strong>: Always verify API exists in Unity version
<strong>Example</strong>: EditorApplication.ExecuteMenuItem may not have all menu items</p>
</section>
<section id="forgetting-execution-policy">
<h3>22. Forgetting Execution Policy<a class="headerlink" href="#forgetting-execution-policy" title="Link to this heading"></a></h3>
<p><strong>Issue</strong>: Scripts blocked by execution policy
<strong>Prevention</strong>: Set policy or use -ExecutionPolicy Bypass
<strong>Example</strong>: <code class="docutils literal notranslate"><span class="pre">Set-ExecutionPolicy</span> <span class="pre">-ExecutionPolicy</span> <span class="pre">RemoteSigned</span> <span class="pre">-Scope</span> <span class="pre">CurrentUser</span></code></p>
</section>
<section id="not-checking-claude-cli-installation">
<h3>23. Not Checking Claude CLI Installation<a class="headerlink" href="#not-checking-claude-cli-installation" title="Link to this heading"></a></h3>
<p><strong>Issue</strong>: Scripts fail if Claude CLI not installed
<strong>Prevention</strong>: Add existence check with graceful fallback
<strong>Example</strong>: <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(Get-Command</span> <span class="pre">claude</span> <span class="pre">-ErrorAction</span> <span class="pre">SilentlyContinue)</span></code></p>
</section>
<section id="ignoring-unity-project-state">
<h3>24. Ignoring Unity Project State<a class="headerlink" href="#ignoring-unity-project-state" title="Link to this heading"></a></h3>
<p><strong>Issue</strong>: Automation fails on uncommitted changes
<strong>Prevention</strong>: Check git status; warn about uncommitted changes
<strong>Example</strong>: Save/commit before running automation</p>
</section>
<section id="module-path-issues">
<h3>25. Module Path Issues<a class="headerlink" href="#module-path-issues" title="Link to this heading"></a></h3>
<p><strong>Issue</strong>: Modules not found despite being present
<strong>Prevention</strong>: Explicitly add to PSModulePath
<strong>Example</strong>: <code class="docutils literal notranslate"><span class="pre">$env:PSModulePath</span> <span class="pre">=</span> <span class="pre">&quot;$PWD\Modules;$env:PSModulePath&quot;</span></code></p>
</section>
</section>
<section id="success-patterns">
<h2>📈 Success Patterns<a class="headerlink" href="#success-patterns" title="Link to this heading"></a></h2>
<section id="incremental-testing">
<h3>26. Incremental Testing<a class="headerlink" href="#incremental-testing" title="Link to this heading"></a></h3>
<p><strong>Pattern</strong>: Test each component in isolation first
<strong>Success Rate</strong>: 95% fewer integration issues
<strong>Implementation</strong>: Run module tests before full automation</p>
</section>
<section id="defensive-coding">
<h3>27. Defensive Coding<a class="headerlink" href="#defensive-coding" title="Link to this heading"></a></h3>
<p><strong>Pattern</strong>: Check every external dependency
<strong>Success Rate</strong>: 80% reduction in runtime failures
<strong>Implementation</strong>: Validate Unity path, Claude CLI, API key</p>
</section>
<section id="comprehensive-logging">
<h3>28. Comprehensive Logging<a class="headerlink" href="#comprehensive-logging" title="Link to this heading"></a></h3>
<p><strong>Pattern</strong>: Log before and after every significant operation
<strong>Success Rate</strong>: 90% faster debugging
<strong>Implementation</strong>: Timestamp, operation, result, errors</p>
</section>
<section id="graceful-degradation">
<h3>29. Graceful Degradation<a class="headerlink" href="#graceful-degradation" title="Link to this heading"></a></h3>
<p><strong>Pattern</strong>: Fallback options for every external dependency
<strong>Success Rate</strong>: System remains partially functional
<strong>Implementation</strong>: API -&gt; CLI -&gt; Manual modes</p>
</section>
<section id="user-feedback">
<h3>30. User Feedback<a class="headerlink" href="#user-feedback" title="Link to this heading"></a></h3>
<p><strong>Pattern</strong>: Clear progress indicators and error messages
<strong>Success Rate</strong>: 75% reduction in user confusion
<strong>Implementation</strong>: Progress bars, status messages, clear errors</p>
</section>
</section>
<section id="performance-optimization-patterns">
<h2>⚡ Performance Optimization Patterns<a class="headerlink" href="#performance-optimization-patterns" title="Link to this heading"></a></h2>
<section id="powershell-performance-best-practices">
<h3>PowerShell Performance Best Practices<a class="headerlink" href="#powershell-performance-best-practices" title="Link to this heading"></a></h3>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="c"># Use StringBuilder for large string operations</span>
<span class="nv">$sb</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">StringBuilder</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$item</span> <span class="k">in</span> <span class="nv">$largeArray</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$sb</span><span class="p">.</span><span class="n">AppendLine</span><span class="p">(</span><span class="nv">$item</span><span class="p">)</span> <span class="p">|</span> <span class="nb">Out-Null</span>
<span class="p">}</span>
<span class="nv">$result</span> <span class="p">=</span> <span class="nv">$sb</span><span class="p">.</span><span class="n">ToString</span><span class="p">()</span>

<span class="c"># Avoid pipeline when not needed</span>
<span class="c"># Slow</span>
<span class="nv">$filtered</span> <span class="p">=</span> <span class="nv">$array</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Status</span> <span class="o">-eq</span> <span class="s2">&quot;Active&quot;</span> <span class="p">}</span>

<span class="c"># Fast</span>
<span class="nv">$filtered</span> <span class="p">=</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$item</span> <span class="k">in</span> <span class="nv">$array</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$item</span><span class="p">.</span><span class="n">Status</span> <span class="o">-eq</span> <span class="s2">&quot;Active&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$item</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c"># Use ArrayList for dynamic arrays</span>
<span class="nv">$arrayList</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">ArrayList</span>
<span class="nv">$arrayList</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="nv">$item</span><span class="p">)</span> <span class="p">|</span> <span class="nb">Out-Null</span>  <span class="c"># Much faster than array +=</span>
</pre></div>
</div>
</section>
<section id="parallel-processing-guidelines">
<h3>Parallel Processing Guidelines<a class="headerlink" href="#parallel-processing-guidelines" title="Link to this heading"></a></h3>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="c"># Only parallelize substantial work (&gt;100ms per item)</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$EstimatedTimePerItem</span> <span class="o">-gt</span> <span class="n">100</span> <span class="o">-and</span> <span class="nv">$ItemCount</span> <span class="o">-gt</span> <span class="n">10</span><span class="p">)</span> <span class="p">{</span>
    <span class="c"># Use ThreadJob for PowerShell 5.1</span>
    <span class="nv">$jobs</span> <span class="p">=</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$item</span> <span class="k">in</span> <span class="nv">$items</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">Start-ThreadJob</span> <span class="n">-ScriptBlock</span> <span class="p">{</span>
            <span class="k">param</span><span class="p">(</span><span class="nv">$item</span><span class="p">)</span>
            <span class="c"># Substantial work here</span>
            <span class="k">Process</span><span class="n">-Item</span> <span class="nv">$item</span>
        <span class="p">}</span> <span class="n">-ArgumentList</span> <span class="nv">$item</span>
    <span class="p">}</span>
    
    <span class="nv">$results</span> <span class="p">=</span> <span class="nv">$jobs</span> <span class="p">|</span> <span class="nb">Wait-Job</span> <span class="p">|</span> <span class="nb">Receive-Job</span>
    <span class="nv">$jobs</span> <span class="p">|</span> <span class="nb">Remove-Job</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c"># Use serial processing</span>
    <span class="nv">$results</span> <span class="p">=</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$item</span> <span class="k">in</span> <span class="nv">$items</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">Process</span><span class="n">-Item</span> <span class="nv">$item</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="memory-management-patterns">
<h3>Memory Management Patterns<a class="headerlink" href="#memory-management-patterns" title="Link to this heading"></a></h3>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="c"># Force garbage collection for large operations</span>
<span class="k">function</span> <span class="nb">Invoke-LargeOperation</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="c"># Large memory operation</span>
        <span class="nv">$largeData</span> <span class="p">=</span> <span class="k">Process</span><span class="n">-LargeDataSet</span>
        <span class="k">return</span> <span class="nv">$largeData</span>
    <span class="p">}</span>
    <span class="k">finally</span> <span class="p">{</span>
        <span class="c"># Force cleanup</span>
        <span class="no">[System.GC]</span><span class="p">::</span><span class="n">Collect</span><span class="p">()</span>
        <span class="no">[System.GC]</span><span class="p">::</span><span class="n">WaitForPendingFinalizers</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c"># Dispose resources properly</span>
<span class="k">function</span> <span class="nb">Use-DatabaseConnection</span> <span class="p">{</span>
    <span class="nv">$connection</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">SqlClient</span><span class="p">.</span><span class="n">SqlConnection</span><span class="p">(</span><span class="nv">$connectionString</span><span class="p">)</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="nv">$connection</span><span class="p">.</span><span class="n">Open</span><span class="p">()</span>
        <span class="c"># Use connection</span>
    <span class="p">}</span>
    <span class="k">finally</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$connection</span><span class="p">.</span><span class="n">State</span> <span class="o">-eq</span> <span class="s2">&quot;Open&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$connection</span><span class="p">.</span><span class="n">Close</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="nv">$connection</span><span class="p">.</span><span class="n">Dispose</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="security-patterns">
<h2>🔒 Security Patterns<a class="headerlink" href="#security-patterns" title="Link to this heading"></a></h2>
<section id="input-validation-and-sanitization">
<h3>Input Validation and Sanitization<a class="headerlink" href="#input-validation-and-sanitization" title="Link to this heading"></a></h3>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nb">Test-SafePath</span> <span class="p">{</span>
    <span class="k">param</span><span class="p">(</span><span class="no">[string]</span><span class="nv">$Path</span><span class="p">)</span>
    
    <span class="c"># Check for path traversal attacks</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$Path</span> <span class="o">-match</span> <span class="s1">&#39;\.\.&#39;</span> <span class="o">-or</span> <span class="nv">$Path</span> <span class="o">-match</span> <span class="s1">&#39;[&lt;&gt;&quot;|*?]&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$false</span>
    <span class="p">}</span>
    
    <span class="c"># Ensure path is within project directory</span>
    <span class="nv">$resolvedPath</span> <span class="p">=</span> <span class="nb">Resolve-Path</span> <span class="nv">$Path</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
    <span class="nv">$projectRoot</span> <span class="p">=</span> <span class="nb">Resolve-Path</span> <span class="nv">$PWD</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="o">-not</span> <span class="nv">$resolvedPath</span> <span class="o">-or</span> <span class="o">-not</span> <span class="nv">$resolvedPath</span><span class="p">.</span><span class="n">Path</span><span class="p">.</span><span class="n">StartsWith</span><span class="p">(</span><span class="nv">$projectRoot</span><span class="p">.</span><span class="n">Path</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$false</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="nv">$true</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nb">Invoke-SafeCommand</span> <span class="p">{</span>
    <span class="k">param</span><span class="p">(</span>
        <span class="no">[string]</span><span class="nv">$Command</span><span class="p">,</span>
        <span class="no">[hashtable]</span><span class="nv">$Parameters</span>
    <span class="p">)</span>
    
    <span class="c"># Whitelist allowed commands</span>
    <span class="nv">$allowedCommands</span> <span class="p">=</span> <span class="p">@(</span>
        <span class="s2">&quot;Get-*&quot;</span><span class="p">,</span> <span class="s2">&quot;Test-*&quot;</span><span class="p">,</span> <span class="s2">&quot;Write-Host&quot;</span><span class="p">,</span> <span class="s2">&quot;Export-*&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;ConvertTo-*&quot;</span><span class="p">,</span> <span class="s2">&quot;ConvertFrom-*&quot;</span><span class="p">,</span> <span class="s2">&quot;Import-Module&quot;</span>
    <span class="p">)</span>
    
    <span class="nv">$isAllowed</span> <span class="p">=</span> <span class="nv">$false</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$pattern</span> <span class="k">in</span> <span class="nv">$allowedCommands</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$Command</span> <span class="o">-like</span> <span class="nv">$pattern</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$isAllowed</span> <span class="p">=</span> <span class="nv">$true</span>
            <span class="k">break</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="o">-not</span> <span class="nv">$isAllowed</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="s2">&quot;Command not allowed: $Command&quot;</span>
    <span class="p">}</span>
    
    <span class="c"># Validate parameters</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$param</span> <span class="k">in</span> <span class="nv">$Parameters</span><span class="p">.</span><span class="n">GetEnumerator</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$param</span><span class="p">.</span><span class="n">Key</span> <span class="o">-eq</span> <span class="s2">&quot;Path&quot;</span> <span class="o">-and</span> <span class="o">-not</span> <span class="p">(</span><span class="nb">Test-SafePath</span> <span class="nv">$param</span><span class="p">.</span><span class="n">Value</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="s2">&quot;Unsafe path parameter: </span><span class="p">$(</span><span class="nv">$param</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span><span class="s2">&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c"># Execute in constrained context</span>
    <span class="p">&amp;</span> <span class="nv">$Command</span> <span class="nv">@Parameters</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="credential-management">
<h3>Credential Management<a class="headerlink" href="#credential-management" title="Link to this heading"></a></h3>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nb">Get-SecureApiKey</span> <span class="p">{</span>
    <span class="c"># Try environment variable first</span>
    <span class="nv">$apiKey</span> <span class="p">=</span> <span class="nv">$env:ANTHROPIC_API_KEY</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$apiKey</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$apiKey</span>
    <span class="p">}</span>
    
    <span class="c"># Try Windows Credential Manager</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="nv">$credential</span> <span class="p">=</span> <span class="nb">Get-StoredCredential</span> <span class="n">-Target</span> <span class="s2">&quot;AnthropicAPI&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$credential</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$credential</span><span class="p">.</span><span class="n">GetNetworkCredential</span><span class="p">().</span><span class="n">Password</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
        <span class="nb">Write-Warning</span> <span class="s2">&quot;Could not access credential manager&quot;</span>
    <span class="p">}</span>
    
    <span class="c"># Prompt user as last resort</span>
    <span class="nv">$secureString</span> <span class="p">=</span> <span class="nb">Read-Host</span> <span class="s2">&quot;Enter Anthropic API Key&quot;</span> <span class="n">-AsSecureString</span>
    <span class="nv">$credential</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Management</span><span class="p">.</span><span class="n">Automation</span><span class="p">.</span><span class="n">PSCredential</span><span class="p">(</span><span class="s2">&quot;api&quot;</span><span class="p">,</span> <span class="nv">$secureString</span><span class="p">)</span>
    <span class="k">return</span> <span class="nv">$credential</span><span class="p">.</span><span class="n">GetNetworkCredential</span><span class="p">().</span><span class="n">Password</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nb">Set-SecureApiKey</span> <span class="p">{</span>
    <span class="k">param</span><span class="p">(</span><span class="no">[string]</span><span class="nv">$ApiKey</span><span class="p">)</span>
    
    <span class="c"># Store in credential manager</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="nv">$secureKey</span> <span class="p">=</span> <span class="nb">ConvertTo-SecureString</span> <span class="nv">$ApiKey</span> <span class="n">-AsPlainText</span> <span class="n">-Force</span>
        <span class="nv">$credential</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Management</span><span class="p">.</span><span class="n">Automation</span><span class="p">.</span><span class="n">PSCredential</span><span class="p">(</span><span class="s2">&quot;api&quot;</span><span class="p">,</span> <span class="nv">$secureKey</span><span class="p">)</span>
        <span class="nb">New-StoredCredential</span> <span class="n">-Target</span> <span class="s2">&quot;AnthropicAPI&quot;</span> <span class="n">-Credential</span> <span class="nv">$credential</span>
        <span class="nb">Write-Host</span> <span class="s2">&quot;API key stored securely&quot;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
        <span class="nb">Write-Warning</span> <span class="s2">&quot;Could not store in credential manager, using environment variable&quot;</span>
        <span class="nv">$env:ANTHROPIC_API_KEY</span> <span class="p">=</span> <span class="nv">$ApiKey</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="logging-security">
<h3>Logging Security<a class="headerlink" href="#logging-security" title="Link to this heading"></a></h3>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nb">Write-SecureLog</span> <span class="p">{</span>
    <span class="k">param</span><span class="p">(</span>
        <span class="no">[string]</span><span class="nv">$Message</span><span class="p">,</span>
        <span class="no">[hashtable]</span><span class="nv">$Data</span> <span class="p">=</span> <span class="p">@{}</span>
    <span class="p">)</span>
    
    <span class="c"># Scrub sensitive data</span>
    <span class="nv">$sanitizedData</span> <span class="p">=</span> <span class="p">@{}</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$key</span> <span class="k">in</span> <span class="nv">$Data</span><span class="p">.</span><span class="n">Keys</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$value</span> <span class="p">=</span> <span class="nv">$Data</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span>
        
        <span class="c"># Redact sensitive fields</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$key</span> <span class="o">-match</span> <span class="s2">&quot;(password|key|token|secret)&quot;</span> <span class="o">-or</span> 
            <span class="p">(</span><span class="nv">$value</span> <span class="o">-is</span> <span class="no">[string]</span> <span class="o">-and</span> <span class="nv">$value</span><span class="p">.</span><span class="n">Length</span> <span class="o">-gt</span> <span class="n">20</span> <span class="o">-and</span> <span class="nv">$value</span> <span class="o">-match</span> <span class="s2">&quot;^[A-Za-z0-9+/=]+$&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$sanitizedData</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="p">=</span> <span class="s2">&quot;*REDACTED*&quot;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$sanitizedData</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="p">=</span> <span class="nv">$value</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="nv">$logEntry</span> <span class="p">=</span> <span class="p">@{</span>
        <span class="n">Timestamp</span> <span class="p">=</span> <span class="nb">Get-Date</span> <span class="n">-Format</span> <span class="s2">&quot;yyyy-MM-dd HH:mm:ss.fff&quot;</span>
        <span class="n">Message</span> <span class="p">=</span> <span class="nv">$Message</span>
        <span class="n">Data</span> <span class="p">=</span> <span class="nv">$sanitizedData</span>
        <span class="n">User</span> <span class="p">=</span> <span class="no">[Environment]</span><span class="p">::</span><span class="n">UserName</span>
        <span class="n">Machine</span> <span class="p">=</span> <span class="no">[Environment]</span><span class="p">::</span><span class="n">MachineName</span>
    <span class="p">}</span>
    
    <span class="nv">$logJson</span> <span class="p">=</span> <span class="nv">$logEntry</span> <span class="p">|</span> <span class="nb">ConvertTo-Json</span> <span class="n">-Compress</span>
    <span class="nb">Add-Content</span> <span class="n">-Path</span> <span class="s2">&quot;secure_operations.log&quot;</span> <span class="n">-Value</span> <span class="nv">$logJson</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="future-considerations">
<h2>🔮 Future Considerations<a class="headerlink" href="#future-considerations" title="Link to this heading"></a></h2>
<section id="claude-cli-updates">
<h3>31. Claude CLI Updates<a class="headerlink" href="#claude-cli-updates" title="Link to this heading"></a></h3>
<p><strong>Watch For</strong>: Piped input support in future versions
<strong>Impact</strong>: Could eliminate SendKeys requirement
<strong>Preparation</strong>: Abstract input method for easy switching</p>
</section>
<section id="unity-version-changes">
<h3>32. Unity Version Changes<a class="headerlink" href="#unity-version-changes" title="Link to this heading"></a></h3>
<p><strong>Watch For</strong>: API changes in newer Unity versions
<strong>Impact</strong>: May break compilation detection
<strong>Preparation</strong>: Version detection and adaptation layer</p>
</section>
<section id="powershell-7-migration">
<h3>33. PowerShell 7 Migration<a class="headerlink" href="#powershell-7-migration" title="Link to this heading"></a></h3>
<p><strong>Watch For</strong>: Organization adoption of PS7
<strong>Impact</strong>: Can use modern features
<strong>Preparation</strong>: Conditional code paths for PS version</p>
</section>
<section id="api-model-evolution">
<h3>34. API Model Evolution<a class="headerlink" href="#api-model-evolution" title="Link to this heading"></a></h3>
<p><strong>Watch For</strong>: New Claude models with different capabilities
<strong>Impact</strong>: Better error analysis and fixes
<strong>Preparation</strong>: Model selection configuration</p>
</section>
<section id="security-requirements">
<h3>35. Security Requirements<a class="headerlink" href="#security-requirements" title="Link to this heading"></a></h3>
<p><strong>Watch For</strong>: Increased security requirements
<strong>Impact</strong>: May need signed scripts, encrypted storage
<strong>Preparation</strong>: Plan for code signing, credential vaults</p>
<hr class="docutils" />
<p><em>This document covers performance optimization and security patterns.</em>
<em>For complete system overview, see IMPLEMENTATION_GUIDE.md</em></p>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Unity-Claude-Automation Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>